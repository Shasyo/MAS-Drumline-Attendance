<!DOCTYPE html>
<html>
<head>
<title>MAS Drumline Attendance</title>
<style>
body { font-family: Arial; padding: 20px; }
input, select, button {
  font-size: 16px; width: 100%; padding: 10px; margin-top: 10px;
}
button {
  background: black; color: white; border: none; cursor: pointer;
}
#status { margin-top: 20px; font-size: 18px; }
</style>
</head>

<body>

<h2>MAS Drumline Attendance</h2>

<input id="fullname" placeholder="Full Name" />

<select id="team">
  <option value="">Select Team</option>
  <option>Ashbal</option>
  <option>Zahrat</option>
  <option>Morshedat</option>
  <option>Kashafeen</option>
  <option>Morasha7 Gawala</option>
</select>

<button onclick="checkIn()">Check In</button>

<p id="status"></p>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwIdtg1cR_bld375dGRwLsldB8MWWk_998Jdd7ipVALdp7pvlQZRpD1ldhzCQeNQQBPfw/exec";

// Generate a simple device fingerprint
const deviceID = btoa(
  navigator.userAgent + screen.width + screen.height + navigator.language
);

function checkIn() {
  const fullName = document.getElementById("fullname").value;
  const team = document.getElementById("team").value;

  if (!fullName || !team) {
    alert("Please fill all fields.");
    return;
  }

  // Get GPS location
  navigator.geolocation.getCurrentPosition(pos => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ fullName, team, deviceID, lat, lng })
    })
    .then(res => res.text())
    .then(msg => {
      if (msg === "OK") {
        document.getElementById("status").innerHTML = "✅ Check-in successful";
      } else if (msg === "DEVICE_EXISTS") {
        document.getElementById("status").innerHTML = "❌ This device already checked in.";
      } else if (msg === "OUT_OF_RANGE") {
        document.getElementById("status").innerHTML = "❌ You are not at the event location.";
      } else {
        document.getElementById("status").innerHTML = "⚠ Something went wrong.";
      }
    });
  }, err => {
    alert("⚠ Unable to get location. Make sure location services are enabled.");
  });
}
</script>

</body>
</html>
